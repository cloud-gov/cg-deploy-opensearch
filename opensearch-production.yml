instance_groups:
- name: opensearch_manager
  vm_type: m6i.xlarge
  instances: 3
  networks:
  - name: services

- name: opensearch_data
  instances: 12
  vm_type: r6i.2xlarge
  update:
    max_in_flight: 2
    canaries: 2

- name: opensearch_dashboards
  vm_type: t3.xlarge
  instances: 2

- name: archiver
  instances: 3
  vm_type: r6i.large

- name: ingestor
  instances: 0
  vm_type: r6i.xlarge.logsearch.ingestor

- name: maintenance
  vm_type: t3.large
  instances: 1
  jobs:
  - name: upload_opensearch_config
    release: opensearch
    properties:
      opensearch_config:
        rollover_document_size: 600gb
        rollover_index_age: 1d
        shard_count: 12
  # - name: curator
  #   release: opensearch
  #   properties:
  #     curator:
  #       purge_logs:
  #         retention_period: 365

- name: ingestor_logsearch_september_1
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/07
              type: syslog

- name: ingestor_logsearch_september_2
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/08
              type: syslog

- name: ingestor_logsearch_august_1
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/09
              type: syslog

- name: ingestor_logsearch_august_2
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/10
              type: syslog

- name: ingestor_logsearch_july_1
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/11
              type: syslog

- name: ingestor_logsearch_july_2
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/12
              type: syslog

- name: ingestor_logsearch_june_1
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/13
              type: syslog

- name: ingestor_logsearch_june_2
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/14
              type: syslog

- name: ingestor_logsearch_may_1
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/23
              type: syslog

- name: ingestor_logsearch_may_2
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/22
              type: syslog

- name: ingestor_logsearch_april_1
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/21
              type: syslog

- name: ingestor_logsearch_april_2
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/20
              type: syslog

- name: ingestor_logsearch_march_1
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/19
              type: syslog

- name: ingestor_logsearch_march_2
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/18
              type: syslog

- name: ingestor_logsearch_february_1
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/17
              type: syslog

- name: ingestor_logsearch_february_2
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/16
              type: syslog

- name: ingestor_logsearch_1
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/06
              type: syslog

- name: ingestor_logsearch_2
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/05
              type: syslog

- name: ingestor_logsearch_3
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/04
              type: syslog

- name: ingestor_logsearch_4
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/03
              type: syslog

- name: ingestor_logsearch_5
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/08/02
              type: syslog

- name: ingestor_logsearch_6
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/07/31
              type: syslog

- name: ingestor_logsearch_7
  instances: 1
  vm_type: r6i.xlarge.logsearch.ingestor
  jobs:
  - name: ingestor_logsearch
    release: opensearch
    properties:
        logstash_parser:
          inputs:
          - plugin: s3
            options:
              bucket: (( grab terraform_outputs.logsearch_archive_bucket_name ))
              region: (( grab terraform_outputs.vpc_region ))
              prefix: 2024/07/30
              type: syslog

addons:
- name: bosh-dns-aliases
  jobs:
  - name: bosh-dns-aliases
    release: bosh-dns-aliases
    properties:
      aliases:
      - domain: nats.service.cf.internal
        targets:
        - deployment: cf-production
          domain: bosh
          instance_group: nats
          network: default
          query: '*'
